<style type="text/css" scoped="scoped">.slgh,.slgh code,.slgh ul, .slgh ol{margin:0;padding:0;border:0;outline:0;background:none;text-align:left;float:none;vertical-align:baseline;position:static;left:auto;top:auto;right:auto;bottom:auto;height:auto;width:auto;line-height:1.1em;font-family:'Courier New', Courier, monospace;font-weight:normal;font-style:normal;font-size:1em;min-height:inherit;min-height:auto;}.slgh{background:#fff;width:99%;margin:1em 0;padding:1px;position:relative;overflow:auto;overflow-y:hidden;}.slgh ul{list-style:none;margin-left:.5em}.slgh ol{margin-left:3.5em}.slgh .bold {font-weight:bold;}.slgh .italic {font-style:italic;}.slgh .no-wrap li{white-space:pre;}.slgh li{padding-left:.5em;}.slgh li{border-left:3px solid #ccc;color:#666;}.slgh li.alt1{background:#fff;padding-left: 1em;}.slgh li.alt2{background:#F8F8F8;padding-left: 1em;}.slgh .plain, .slgh .plain a{color:#000;}.slgh .comments, .slgh .comments a{color:#008200;}.slgh .string, .slgh .string a{color:blue;}.slgh .keyword{color:#069;font-weight:bold;}.slgh .preprocessor {color:gray;}.slgh .variable{color:#a70;}.slgh .value{color:#090;}.slgh .functions{color:#ff1493;}.slgh .constants{color:#0066CC;}.slgh .script{background:yellow;}.slgh .color1,.slgh .color1 a{color:#808080;}.slgh .color2,.slgh .color2 a{color:#ff1493;}.slgh .color3,.slgh .color3 a{color:red;}.slghcr{margin:-.5em 1.2em}.slghcr a{color:#aaa;background:#fff;text-decoration:none;border-bottom:1px dotted #aaa;font-size:.6em;font-family:arial}</style><div id="hler_5752" class="slgh"><ol class="lines no-wrap"><li class="alt1"><code class="keyword">from</code> <code class="plain">threading </code><code class="keyword">import</code> <code class="plain">Thread</code></li><li class="alt2"><code class="keyword">import</code> <code class="plain">serial</code></li><li class="alt1"><code class="keyword">import</code> <code class="plain">time</code></li><li class="alt2"><code class="keyword">import</code> <code class="plain">matplotlib.pyplot as plt</code></li><li class="alt1"><code class="keyword">import</code> <code class="plain">matplotlib.animation as animation</code></li><li class="alt2"><code class="comments"># import serial.tools.list_ports_osx</code></li><li class="alt1"><code class="keyword">import</code> <code class="plain">serial.tools.list_ports_windows</code></li><li class="alt2"><code class="keyword">import</code> <code class="plain">struct</code></li><li class="alt1"><code class="keyword">import</code> <code class="plain">numpy as np</code></li><li class="alt2">&nbsp;</li><li class="alt1"><code class="keyword">class</code> <code class="plain">SerialReader:</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Инициализатор класса</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">__init__(</code><code class="color1">self</code><code class="plain">) </code><code class="keyword">-</code><code class="plain">&gt; </code><code class="color1">None</code><code class="plain">:</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">baudrate </code><code class="keyword">=</code> <code class="value">115200</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">port </code><code class="keyword">=</code> <code class="color1">self</code><code class="plain">.askport()</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.Thread </code><code class="keyword">=</code> <code class="color1">None</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.data </code><code class="keyword">=</code> <code class="plain">[</code><code class="value">0</code><code class="plain">,</code><code class="value">0</code><code class="plain">,</code><code class="value">0</code><code class="plain">]</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.abs_data </code><code class="keyword">=</code> <code class="plain">[</code><code class="value">0</code><code class="plain">,</code><code class="value">0</code><code class="plain">,</code><code class="value">0</code><code class="plain">]</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.filt_data </code><code class="keyword">=</code> <code class="plain">[</code><code class="value">0</code><code class="plain">,</code><code class="value">0</code><code class="plain">,</code><code class="value">0</code><code class="plain">]</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.isRuining </code><code class="keyword">=</code> <code class="color1">True</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.WINDOWLENGTH </code><code class="keyword">=</code> <code class="value">125</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.last_data </code><code class="keyword">=</code> <code class="plain">time.time()</code><code class="keyword">*</code><code class="value">1000</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">'Trying to connect to: '</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(port) </code><code class="keyword">+</code> <code class="string">' at '</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(baudrate) </code><code class="keyword">+</code> <code class="string">' BAUD.'</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">try</code><code class="plain">:</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.serialConnection </code><code class="keyword">=</code> <code class="plain">serial.Serial(port, baudrate, timeout</code><code class="keyword">=</code><code class="value">0.02</code><code class="plain">)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">'Connected to '</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(port) </code><code class="keyword">+</code> <code class="string">' at '</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(baudrate) </code><code class="keyword">+</code> <code class="string">' BAUD.'</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">except</code><code class="plain">:</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">"Failed to connect with "</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(port) </code><code class="keyword">+</code> <code class="string">' at '</code> <code class="keyword">+</code> <code class="functions">str</code><code class="plain">(baudrate) </code><code class="keyword">+</code> <code class="string">' BAUD.'</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Функция для запроса порта к которому необходимо подключится</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">askport(</code><code class="color1">self</code><code class="plain">) </code><code class="keyword">-</code><code class="plain">&gt; </code><code class="functions">int</code><code class="plain">:</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">"Available ports: "</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">devices </code><code class="keyword">=</code> <code class="plain">[]</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">i </code><code class="keyword">=</code> <code class="value">0</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">for</code> <code class="plain">port </code><code class="keyword">in</code> <code class="functions">list</code><code class="plain">(serial.tools.list_ports_windows.comports()):</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">devices.append(port.device)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="functions">str</code><code class="plain">(i)</code><code class="keyword">+</code><code class="string">": "</code><code class="plain">, port)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">i</code><code class="keyword">+</code><code class="keyword">=</code><code class="value">1</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">return</code> <code class="plain">devices[</code><code class="functions">int</code><code class="plain">(</code><code class="functions">input</code><code class="plain">(</code><code class="string">"Write device number: "</code><code class="plain">))]</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Начало передачи данных и создание потока</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">startThread(</code><code class="color1">self</code><code class="plain">):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.serialConnection.write(b</code><code class="string">"stop\n"</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">time.sleep(</code><code class="value">0.1</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.serialConnection.write(b</code><code class="string">"start\n"</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">if</code><code class="plain">(</code><code class="color1">self</code><code class="plain">.Thread </code><code class="keyword">=</code><code class="keyword">=</code> <code class="color1">None</code><code class="plain">):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.Thread </code><code class="keyword">=</code> <code class="plain">Thread(target</code><code class="keyword">=</code><code class="color1">self</code><code class="plain">.GetData)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.Thread.start()</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">GetData(</code><code class="color1">self</code><code class="plain">):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">while</code><code class="plain">(</code><code class="color1">self</code><code class="plain">.isRuining):</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">if</code><code class="plain">(</code><code class="color1">self</code><code class="plain">.serialConnection.in_waiting &gt;</code><code class="keyword">=</code> <code class="value">16</code><code class="plain">):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">readed </code><code class="keyword">=</code> <code class="color1">self</code><code class="plain">.serialConnection.read(</code><code class="value">4</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">if</code><code class="plain">(readed </code><code class="keyword">=</code><code class="keyword">=</code> <code class="plain">b</code><code class="string">"DATA"</code><code class="plain">): </code><code class="comments">#Пропускаем часть не показательных данных</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.serialConnection.read(</code><code class="value">12</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">else</code><code class="plain">:</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">unpacked </code><code class="keyword">=</code> <code class="plain">struct.unpack(</code><code class="string">"f"</code><code class="plain">, readed)[</code><code class="value">0</code><code class="plain">] </code><code class="comments">#Переводим в float</code></li><li class="alt2">&nbsp;</li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">if</code><code class="plain">(np.isnan(unpacked)):</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">continue</code> <code class="comments">#Проверяем на число</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">if</code><code class="plain">(unpacked &gt; </code><code class="value">3000</code> <code class="keyword">or</code> <code class="plain">unpacked &lt; </code><code class="keyword">-</code><code class="value">3000</code><code class="plain">): </code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">continue</code> <code class="comments">#Фильтруем выбросы</code></li><li class="alt2">&nbsp;</li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">current_point </code><code class="keyword">=</code> <code class="functions">float</code><code class="plain">(unpacked) </code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.data.append(current_point)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.abs_data.append(</code><code class="functions">abs</code><code class="plain">(current_point))</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Применяем фильтр с плаваюшим окном</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.filt_data.append(</code><code class="functions">sum</code><code class="plain">(</code><code class="color1">self</code><code class="plain">.abs_data[</code><code class="keyword">-</code><code class="color1">self</code><code class="plain">.WINDOWLENGTH:]) </code><code class="keyword">/</code> <code class="color1">self</code><code class="plain">.WINDOWLENGTH)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Обрезаем данные до необходимого окна во избежании утечек памяти</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.data </code><code class="keyword">=</code> <code class="color1">self</code><code class="plain">.data[</code><code class="keyword">-</code><code class="value">1024</code><code class="plain">:]</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.abs_data </code><code class="keyword">=</code> <code class="color1">self</code><code class="plain">.abs_data[</code><code class="keyword">-</code><code class="value">1024</code><code class="plain">:]</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.filt_data </code><code class="keyword">=</code> <code class="color1">self</code><code class="plain">.filt_data[</code><code class="keyword">-</code><code class="value">1024</code><code class="plain">:]</code></li><li class="alt2">&nbsp;</li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.last_data </code><code class="keyword">=</code> <code class="plain">time.time()</code><code class="keyword">*</code><code class="value">1000</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Закрытие порта, потока, остановка передачи данных</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">close(</code><code class="color1">self</code><code class="plain">):</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.isRuining </code><code class="keyword">=</code> <code class="color1">False</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.Thread.join()</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.serialConnection.write(b</code><code class="string">"stop\n"</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.serialConnection.close()</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">'Disconnected...'</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="comments">#Функция для очистки данных&nbsp;&nbsp;&nbsp; </code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">clear(</code><code class="color1">self</code><code class="plain">):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.data </code><code class="keyword">=</code> <code class="plain">[]</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.abs_data </code><code class="keyword">=</code> <code class="plain">[]</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="color1">self</code><code class="plain">.filt_data </code><code class="keyword">=</code> <code class="plain">[]</code></li><li class="alt2">&nbsp;</li><li class="alt1">&nbsp;</li><li class="alt2"><code class="keyword">def</code> <code class="plain">getPorogs(reader):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">def</code> <code class="plain">getPorog(text1, text2, text3):</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">"Переходим к настройке "</code><code class="keyword">+</code><code class="plain">text1</code><code class="keyword">+</code><code class="string">" порога!"</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">"В течении следующих 5 секунд "</code><code class="keyword">+</code><code class="plain">text2</code><code class="keyword">+</code><code class="string">" руку."</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">"Напишите что-ниубдь когда будете готовы"</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">input</code><code class="plain">()</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">vals </code><code class="keyword">=</code> <code class="plain">[]</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">for</code> <code class="plain">i </code><code class="keyword">in</code> <code class="functions">range</code><code class="plain">(</code><code class="value">5</code><code class="plain">):</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">reader.clear()</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">time.sleep(</code><code class="value">1</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(i)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">vals.append( (</code><code class="functions">max</code><code class="plain">(reader.filt_data)</code><code class="keyword">+</code><code class="functions">min</code><code class="plain">(reader.filt_data)) </code><code class="keyword">/</code> <code class="value">2</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">value </code><code class="keyword">=</code> <code class="functions">sum</code><code class="plain">(vals) </code><code class="keyword">/</code> <code class="functions">len</code><code class="plain">(vals)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(</code><code class="string">"Готово!"</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">print</code><code class="plain">(value, </code><code class="string">" - "</code><code class="keyword">+</code><code class="plain">text3</code><code class="keyword">+</code><code class="string">" значение"</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">return</code> <code class="plain">value</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">ans </code><code class="keyword">=</code> <code class="functions">input</code><code class="plain">(</code><code class="string">"Провести повторную калибровку пороговых значений или загрузить значения из файла?\n1 - Загрузить\n2 - Провести повторно\nОтвет:"</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">if</code><code class="plain">(ans </code><code class="keyword">=</code><code class="keyword">=</code> <code class="string">"2"</code><code class="plain">):</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">maximum </code><code class="keyword">=</code> <code class="plain">getPorog(</code><code class="string">"максимального"</code><code class="plain">, </code><code class="string">"максимально напрягите"</code><code class="plain">, </code><code class="string">"Максимальное"</code><code class="plain">)</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">minimum </code><code class="keyword">=</code> <code class="plain">getPorog(</code><code class="string">"минимального"</code><code class="plain">, </code><code class="string">"максимально расслабьте"</code><code class="plain">, </code><code class="string">"Минимальное"</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="functions">open</code><code class="plain">(</code><code class="string">"porogs.txt"</code><code class="plain">, </code><code class="string">"w"</code><code class="plain">).write(</code><code class="functions">str</code><code class="plain">(maximum)</code><code class="keyword">+</code><code class="string">";"</code><code class="keyword">+</code><code class="functions">str</code><code class="plain">(minimum))</code></li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">else</code><code class="plain">:</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">maximum, minimum </code><code class="keyword">=</code> <code class="functions">list</code><code class="plain">(</code><code class="functions">map</code><code class="plain">(</code><code class="functions">float</code><code class="plain">, </code><code class="functions">open</code><code class="plain">(</code><code class="string">"porogs.txt"</code><code class="plain">, </code><code class="string">"r"</code><code class="plain">).readline().split(</code><code class="string">";"</code><code class="plain">)))</code></li><li class="alt2">&nbsp;</li><li class="alt1">&nbsp;</li><li class="alt2">&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">porog1 </code><code class="keyword">=</code> <code class="plain">minimum </code><code class="keyword">+</code> <code class="plain">((maximum</code><code class="keyword">-</code><code class="plain">minimum) </code><code class="keyword">/</code> <code class="value">3</code><code class="plain">)</code></li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="plain">porog2 </code><code class="keyword">=</code> <code class="plain">minimum </code><code class="keyword">+</code> <code class="plain">(((maximum</code><code class="keyword">-</code><code class="plain">minimum) </code><code class="keyword">/</code> <code class="value">3</code><code class="plain">)</code><code class="keyword">*</code><code class="value">2</code><code class="plain">)</code></li><li class="alt2">&nbsp;</li><li class="alt1">&nbsp;&nbsp;&nbsp;&nbsp;<code class="keyword">return</code> <code class="plain">(maximum, minimum, porog1, porog2)</code></li></ol></div><div class="slghcr">Подсветка програмного кода</div>